@model IEnumerable<DuAn_DoAnNhanh.Data.ViewModel.ComboWithProductsViewModel>

<div class="search-container mb-4">
    <form asp-action="GetAll" method="get">
        <input type="text" name="searchTerm" value="@ViewBag.SearchTerm" placeholder="Tìm kiếm combo..." class="form-control" />
        <button type="submit" class="btn btn-primary mt-2">Tìm kiếm</button>
    </form>
</div>

<p>
    <a id="openModal" style="color: white; background-color: red; padding: 10px 20px; border-radius: 5px; text-decoration: none; cursor: pointer;">
        Thêm Combo
    </a>
</p>

<!-- Modal cho việc tạo combo -->
<div id="comboModal" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-body">
                @await Component.InvokeAsync("ComboCreate")
            </div>
        </div>
    </div>
</div>

@if (Model == null || !Model.Any())
{
    <div class="alert alert-warning" role="alert">
        Combo trống.
    </div>
}
else
{
    <div class="row" id="comboList">
        @foreach (var combo in Model)
        {
            <div class="col-md-6 col-sm-12 mb-4 combo-item">
                <div class="card h-100 position-relative combo-card">
                    <a href="@Url.Action("Delete", "Combo", new { id = combo.Combo.ComboID })"
                       class="btn btn-danger position-absolute top-0 end-0 m-2 delete-combo-btn"
                       title="Xóa combo">
                        X
                    </a>
                    <img class="card-img-top" src="@combo.Combo.Image" style="height: 300px; object-fit: cover;">
                    <div class="card-body">
                        <h4 class="card-title"><b>@combo.Combo.ComboName</b></h4>
                        @foreach (var item in combo.Products)
                        {
                            <h5 class="card-title">@item.Quantity x @item.ProductName</h5>
                        }
                        @if (combo.Combo.SetupPrice == null)
                        {
                            <h3 class="card-title" style="color: red;"><b>@combo.Combo.Price.ToString("N0") đ</b></h3>
                        }
                        else
                        {
                            <p class="card-title" style="color: red;"><b><del>@combo.Combo.Price.ToString("N0")</del> đ</b></p>
                            <h3 class="card-title" style="color: red;"><b>@(combo.Combo.SetupPrice.HasValue ? combo.Combo.SetupPrice.Value.ToString("N0") : "0") đ</b></h3>
                        }
                        @Html.ActionLink("Xem chi tiết", "Details", new { id = combo.Combo.ComboID }, new { @class = "btn btn-primary" })
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Phân trang -->
    @if (ViewBag.TotalPages > 1)
    {
        <div class="pagination text-center mt-4">
            @if (ViewBag.CurrentPage > 1)
            {
                <a href="@Url.Action("GetAll", new { page = ViewBag.CurrentPage - 1, searchTerm = ViewBag.SearchTerm })" class="btn btn-secondary">Trang trước</a>
            }
            @for (int i = 1; i <= ViewBag.TotalPages; i++)
            {
                <a href="@Url.Action("GetAll", new { page = i, searchTerm = ViewBag.SearchTerm })" class="btn @(i == ViewBag.CurrentPage ? "btn-primary" : "btn-secondary")">@i</a>
            }
            @if (ViewBag.CurrentPage < ViewBag.TotalPages)
            {
                <a href="@Url.Action("GetAll", new { page = ViewBag.CurrentPage + 1, searchTerm = ViewBag.SearchTerm })" class="btn btn-secondary">Trang sau</a>
            }
        </div>
    }
}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    $(document).ready(function () {
        $("#openModal").click(function () {
            $("#comboModal").modal('show');
        });

        $(".close").click(function () {
            $("#comboModal").modal('hide');
        });
    });
</script>

<style>
    .combo-card {
        transition: transform 0.2s;
    }

        .combo-card:hover {
            transform: scale(1.02);
        }

    .delete-combo-btn {
        display: none;
    }

    .combo-card:hover .delete-combo-btn {
        display: block;
    }
</style>